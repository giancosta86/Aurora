# Aurora

*Elegant Gradle projects for the JVM*


## Introduction


Aurora is a plugin for Gradle that quickly configures a project hosted on GitHub, with optional support for several plugins:

* [maven](https://docs.gradle.org/current/userguide/maven_plugin.html)

* [application](https://docs.gradle.org/current/userguide/application_plugin.html)

* [Bintray](https://github.com/bintray/gradle-bintray-plugin)

* [TODO](https://github.com/AutoScout24/gradle-todo-plugin)

* [MoonLicense-Gradle](https://github.com/giancosta86/MoonLicense-Gradle)

* [MoonDeploy-Gradle](https://github.com/giancosta86/MoonDeploy-Gradle)

Support for a plugin is enabled only if Aurora detects that such plugin has been applied to the project.

The supported languages are currently:

* **Scala**

* **Groovy**

* **Java**


Aurora's goal is to reduce boilerplate configuration, by providing the following automatic features - *enabled only when the related projects are available*:

* Check project constraints (e.g.: **project.description** must be set)

* Set **project.ext.url** to the GitHub page of the project

* Initialize **project.ext.facebookPage** to *null* - if it is not already set

* Generate an **ArtifactInfo** class/object, providing information about the project. It will be located:

  * generally, in a subpackage named according to the *artifact id*

  * in the project's root package, if the *artifact id* matches the last component of the root package

* Add Maven repositories to locate dependencies; if **addDefaultRepositories** is *true* (the default), the following repositories will be added - in order:

  1. Maven local

  2. JCenter

  3. Maven Central

  4. [Hephaestus](https://bintray.com/giancosta86/Hephaestus)

* Setup a *sources* and a *Javadoc* jar, for Maven deployment. The actual documentation task (**scaladoc**, **groovydoc** or **javadoc**) is automatically inferred


* Setup the **uploadArchives** task to deploy to a temporary directory: **${project.buildDir}/mavenTemp**.
This strategy simplifies deployment to Bintray

* Generate a POM including:

  * **name**

  * **description**

  * **url**

  * **developers**

  * **scm**


* Setup Bintray deployment, using the project information and a few sensible defaults:

  * **publish** = false

  * **dryRun** = false

  * **pkg/publicDownloadNumbers** = false

  * **pkg/githubRepo** = **auroraSettings.gitHubUser**/**project.name**

  * **pkg/githubReleaseNotesFile** = *README.md*

  * **pkg/version/released** = new Date()

  * **pkg/version/gpg/sign** = true

  * **pkg/version/mavenCentralSync/publish** = false


* Read missing Bintray credentials from a file whose path is declared in the **BINTRAY_CREDENTIALS_FILE** environment path. If existing, it must be a *.properties* file having one or more of the following keys:

  * **bintrayUser**: your Bintray user name

  * **bintrayKey**: the password

* Create task **checkGit**, ensuring that the project's directory is *clean*

* Create task **generateArtifactInfo**, generating an artifact source file exposing the project information

* Create task **generateAppDescriptor**, creating a [MoonDeploy](http://gianlucacosta.info/moondeploy) app descriptor based on sensible defaults, in particular:

  * Icon named **mainIcon.ico** on Windows and **mainIcon.png** on every other system

  * Directory layout based on the **application** plugin

  * **Base URL**: *project's GitHub URL*/**releases/latest**

* Create task **assertRelease**, failing if the **release** parameter in Aurora settings is not *true*

* For *distribution* packages generated by the **application** plugin:

  * Include scripts for ensuring the required Java version (if declared in the project settings) is installed: if the user does not have at least such version, the Java download page is opened in a browser

  * For GUI applications (the default), use **javaw** in lieu of **java** on Windows

* Disable the **distTar** task for the application plugin - focusing on **distZip**

* the **checkTodo** task will fail if **release** is *true*

* Setup tasks dependencies:

  * both **compileJava** and **processResources** depend on **setNotices** (which is provided by [MoonLicense-Gradle](https://github.com/giancosta86/MoonLicense-Gradle)).

  * both **uploadArchives** and **install** depend on the **check** task

  * if **release** is *true*, **compileJava** and **processResources** depend on **checkGit**

  * **_bintrayRecordingCopy** depends on **assertRelease** and **uploadArchives**

  * **compileJava** and **setNotices** depend on **generateArtifactInfo**

  * **compileJava** and **processResources** depend on **checkTodo**

  * **generateAppDescriptor** depends on **distZip**

  * **distZip** and **distTar** depend on **assertRelease**

  * **assemble** depends on **generateAppDescriptor**

* DSL-based configuration


## Installation

At the very beginning of your build script, add:

```groovy
buildscript {
    repositories {
        jcenter()

        maven {
            url 'https://dl.bintray.com/giancosta86/Hephaestus'
        }
    }

    dependencies {
        classpath 'info.gianlucacosta.aurora:aurora:3.0'
    }
}
```

To apply the plugin:

```groovy
apply plugin: 'info.gianlucacosta.aurora'
```

**PLEASE NOTE**: Aurora must be declared after the plugins it relies on (see above) - generally speaking, *it might be a good idea to declare Aurora after all the other plugins*


## Usage

Aurora will configure your project when reaching the following DSL block:

```groovy
aurora {
    gitHubUser  = "<GitHub user id>"

    docTask = "javadoc" //or "groovydoc", or "scaladoc", ... OPTIONAL (it is inferred)    

    release = true //OPTIONAL. Default: true

    commandLineApp = false //OPTIONAL. Default: false

    addDefaultRepositories = true //Default: true

    author {
        name = "<Author name>"
        email = "<Author's e-mail address>"
        url = "<Author's url - OPTIONAL>"
    }

    bintray {
        user = "<Bintray API user id - OPTIONAL>"
        key = "<Bintray API key - OPTIONAL>"

        repo = "<Target repository on Bintray>"

        licenses = ['Apache-2.0'] //The strings should follow Bintray's conventions

        labels = ["testLabel1", "testLabel2"] //Tags following Bintray's conventions
    }

    javaVersion {  //This makes Java 1.8.0_65 or later required to run the application. OPTIONAL
      major = 1  //Default: 0
      minor = 8 //Default: 0
      build = 0 //Default: 0
      update = 65 //Default: 0
    }
}
```

### Settings

* **gitHubUser**: GitHub user hosting the project.
*It is assumed that the repository on GitHub is named like the project* (more precisely, its name must be **project.name**)

* **docTask**: the task providing the files for the Javadoc archive. It is *optional*, as it is automatically inferred according to your language-related plugins. Usual values will be:

  * **javadoc** for Java

  * **groovydoc** for Groovy

  * **scaladoc** for Scala

* **release**: determines whether the build process will create artifacts suitable for release. The default value is *true*. This flag controls several aspects of the plugin

* **commandLineApp**: if *false* (the default) **javaw** will be used instead of **java**, on Windows, when generating the **application** distribution

* **addDefaultRepositories**: if *true*, default repositories will be added to the project (see above)

* **author** can be used one or more times to add authors to the project. Each **author** block requires:

  * **name**: the author's name

  * **email**: the author's e-mail address

  * **url**: the author's url. (OPTIONAL)

* **bintray**: settings passed to the *bintray* block provided by the Bintray plugin. In particular:

  * **user**: the authentication user id. OPTIONAL - can be read from a properties file (see above)

  * **key**: the authentication key. OPTIONAL - can be read from a properties file (see above)

  * **repo**: the repository name

  * **licenses**: a list of license strings, complying with Bintray's format

  * **labels**: the label tags to be shown on Bintray

**javaVersion**: if declared, will generate code - for the **application** plugin distribution - checking that the required Java version (or later) is installed.
